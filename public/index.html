<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TicTacToe Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #74ebd5 0%, #9face6 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      color: #333;
    }
    h1 { margin-bottom: 10px; }
    #room-section { margin-bottom: 20px; text-align: center; }
    input, button {
      padding: 10px; border-radius: 8px; border: none; outline: none;
      margin: 5px; font-size: 16px;
    }
    button {
      background: #4CAF50; color: white; cursor: pointer; transition: 0.3s;
    }
    button:hover { background: #45a049; }
    #board {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      grid-template-rows: repeat(3, 100px);
      gap: 5px;
    }
    .cell {
      width: 100px; height: 100px; background: rgba(255,255,255,0.8);
      display: flex; align-items: center; justify-content: center;
      font-size: 2.5em; border-radius: 12px; cursor: pointer; transition: background 0.3s;
    }
    .cell:hover { background: rgba(255,255,255,1); }
    #status { margin-top: 20px; font-size: 18px; font-weight: bold; }
    @media (max-width: 500px) {
      #board { grid-template-columns: repeat(3, 80px); grid-template-rows: repeat(3, 80px); }
      .cell { width: 80px; height: 80px; font-size: 2em; }
    }
  </style>
</head>
<body>
  <h1>ðŸŽ® TicTacToe Online</h1>
  <div id="room-section">
    <input type="text" id="roomId" placeholder="Room ID">
    <button onclick="createRoom()">Create</button>
    <button onclick="joinRoom()">Join</button>
  </div>
  <div id="board"></div>
  <div id="status">Join a room to start!</div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io({ path: "/api/socket" });
    let roomId = null;
    let symbol = null;
    let boardState = Array(9).fill('');
    let currentTurn = "X";

    const boardEl = document.getElementById("board");
    const statusEl = document.getElementById("status");

    for (let i = 0; i < 9; i++) {
      const cell = document.createElement("div");
      cell.className = "cell";
      cell.dataset.index = i;
      cell.addEventListener("click", () => makeMove(i));
      boardEl.appendChild(cell);
    }

    function createRoom() {
      roomId = document.getElementById("roomId").value.trim();
      if (!roomId) return alert("Enter room ID!");
      socket.emit("createRoom", roomId);
    }

    function joinRoom() {
      roomId = document.getElementById("roomId").value.trim();
      if (!roomId) return alert("Enter room ID!");
      socket.emit("joinRoom", roomId);
    }

    function makeMove(i) {
      if (boardState[i] || currentTurn !== symbol) return;
      socket.emit("makeMove", { roomId, index: i, symbol });
    }

    socket.on("roomCreated", (data) => {
      symbol = data.symbol;
      statusEl.innerText = "Waiting for opponent...";
    });

    socket.on("roomJoined", (data) => {
      symbol = data.symbol;
      statusEl.innerText = "Game started! You are O";
    });

    socket.on("update", (room) => {
      boardState = room.board;
      currentTurn = room.turn;
      document.querySelectorAll(".cell").forEach((cell, i) => {
        cell.innerText = boardState[i];
      });
      const winner = checkWinner(boardState);
      if (winner) {
        statusEl.innerText = `${winner} Wins ðŸŽ‰`;
      } else {
        statusEl.innerText = (currentTurn === symbol ? "Your turn!" : "Opponent's turn...");
      }
    });

    socket.on("errorMsg", (msg) => alert(msg));

    function checkWinner(b) {
      const wins = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      for (const [a,b1,c] of wins) {
        if (b[a] && b[a] === b[b1] && b[a] === b[c]) return b[a];
      }
      return null;
    }
  </script>
</body>
</html>
